from math import gcd
from os import urandom
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
from Crypto.Util.number import bytes_to_long, isPrime
from hashlib import sha256
from secret import message, p 

def RSA_Hint(m, p):
    e = bytes_to_long(urandom(4))
    while gcd(e, p - 1) != 1:
        e = bytes_to_long(urandom(4))

    return (e, pow(m, e, p))

if __name__ == '__main__':
    m = bytes_to_long(message)
    assert isPrime(p) and m > p 

    e, c = RSA_Hint(m, p)
    print(f'{p = }')
    # print(f'{e = }') 
    print(f'{c = }')

    key = sha256(str(m % p).encode()).digest()[:16]

    cipher = AES.new(key, AES.MODE_CBC)
    enc = cipher.encrypt(pad(message, 16)).hex()
    iv = cipher.iv

    # print(f'{iv = }')
    print(f'{enc = }')

# p = 2825047626839027306333001463372625927941155833234919686856571839316009571282871835916649609373791698521316424058805894097519652216910911539964003613959096129418433634506969783406213372007566059186882006868456704739988426765391011275951600269493440880174916527766497141892142209796013228877393733182404313025233485215706760102850990607283705624930667356008697806702977074380166742454511295695039208330464521631540061843489331644240710039353803380853726239681469650067080730950208780384411099976139490391442658331115244471357264045405757069565273426794139435001575650176171605527491507334688460164800650369840794497
# c = 1234065446435159909315154109029154540851051946122339844698225416580881030506087038872058842931230698875145437724417086064486127172062729683944479449598598030820271752363903968690638597888186859103166558929754789927101282614745208632671047762523597899512220523405484397711050340422917270445358537955639667110332835453910764605729332678908562260463487907157071964222699152733292288509261027639817027531293328533215578010740524459495413003995940423778009030694497205491543363973795293404873562365367640252793506243441448398689896185656272569232001132673312637815493781923757701703725289130004047096657165353282778023
# enc = '3b44789211a0d2e8ac14fdef0c1bb94622f098a1199f905b359cf6e651d8c16ea0c9f0395ce3f2ae3cc0ae0d6256fa336682377cdf1835e1e6c2fb2e728635117c938a7e1b7a897316713b65790a665d9bbd557f28f3d616326fc5870ad9f2699b3873fce7b87e926905bcc8a8f61cec53bdb97b8b7495c3b388a4229a3b856b80052315433d55969a696fa2642646842730f3883fa2623984ecb247753b62948e60a022d89a1f2c05b0d9168f8f01c18cf7f1124471e640c2589e25b3a165f4cf95835ef2b4b994b5697287b6104ccf1f7834e014b9e5fa367a4395fea3482433bf7c33cf7fc39f099aef60833750a54c03187e6fa991256f3430ca45abe3f55a59269b7a83578f04b123aac0fdd224a40de422dba016d34269ae4434208a089ddd04692d5fef4fb09751ed8ed5f7f68ec16ae4f18b4e1913ef3542b573b0fc94f6c392134f22768f24290d89126177603fd921744acc753b5fce3197d1cb8c3e3e3766ca5db04c29878f42fd3281f0c4acdcfba3f5806f09b39db897f2c1301838f76730e780adcb36cf3c083cdb021e60270d2e8c7d222d3e8348df14a1eb836561133edf6a0810e2c8012c1b08e92f31cb79477a2d39df2280d0b7e941be3e3230644162a571ac575c2fab61e3d08bd3b6f847a002ef2bc1b56a79536735ac5e377c1fb2f5bc92108d86d783104dd603d3ea4d2dc55e7d858ec4e5679ebcb4082f9bbfab0165f1f969bc69d9f1f7b204cce732334b84d91f74b594ca7ab41da750c8b3582d4d9628c871d420d1d8c2a30d96eab3625f1a3f5eb0af784f45dbb8d680c6eb05c170c5f8e6905d9b33f6ae9d00db265d0eb72699752fe682d58924ab70f751eda41bda8e5f23557cf2584b105991cffe73424eb9bc9481b8f0095a8adfaef31b90195aac52aecf230db7c99ad8d2eb41092ff04661d6f40c94372e427909acc23ee825424ae42cf845cb2923c9b30dbcc0e98a89557c8eca37761ec4bcc5e855155e163343210bf5cf8094efac66f7c8e3a8613224eb028e75616cb89c204f9dd3dbcdd2d703cbef0f123b86c319a5339a03e7929cd86f9f15dce31f5c4050a017e4f097c2df41bd1141863726066606cf38a5f7c81a92a55ac7ecba4986dc9e7fe07eead12537333e6c85c48f665bc716d3dc58d9a01f517faf209b2bcd1ce93bd202aa70bca891bdd16d6b8519a1c8388e6eda56b3994e285aab06ec5053556619d02217a9f99af3224bfd9c76365b32eb55679e8d8785f4ffa70c43b743f0b3557298f1cd7066c7fc05ecb6111ba441245d4371f93227694bedfb1332743d7c69e56a9ab1e83bf21bf3fb2d2e494f62188b87bfc1999ccc11bc060c3e8688df391e6883322c601b7cb0f947352d7681e231d0c54b21b869f702c5381170c8f03ba25411044919a0e395826e4bac2f31483c798a0534571a850034d059f50798b0e4034ee1169a91d0d490e470b8e4ae73321dc428b8af0dc71d2da7aeeb5328671915ebf71e08bf9bb24cacded8a73ec2d8e9b23d25a25d6581edd5a64f2a4fab663456c49dc1d87a2752a7904859bfae838cb80c42476acb362afaebfc829cb464693e933ac77743e70bb67fbd3027e9d486d70e4ed4d77a1b98e084afd239d245a13eeb89936badf2b42aa8169b16fff74536ea1fc14e2b274f34b8a23e0493f605829f6ee387fbd30e214af8a026c55383f96d872afa1e34ff09f6938142704c04da968112707bd7c1956a8d877f8cbbe1fc5cef1cc5804a0cb72816961b6ee9bc275b7330bebb0f2cbc0c49fed149e759adf53e9565'
